{% extends 'admin_base.html' %}

{% block title %}Laudo Calazar - {{ solicitacao.protocolo }} - VISA Digital{% endblock %}

{% block content %}
<style>
    /* Estilos para impressão */
    @media print {
        body * {
            visibility: hidden; /* Esconde tudo por padrão */
        }
        .printable-area, .printable-area * {
            visibility: visible; /* Torna visível a área de impressão e seus filhos */
        }
        .printable-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%; /* Ajusta à largura da página */
            padding: 15mm 20mm; /* Margens para impressão */
            box-sizing: border-box;
            font-size: 10pt; /* Tamanho de fonte para impressão */
            line-height: 1.5;
        }
        .no-print {
            display: none; /* Elementos que não devem aparecer na impressão */
        }
        .alert .btn-close {
            display: none; 
        }
        .header-print {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }
        .header-print h3, .header-print h4 {
            margin: 0;
            font-size: 12pt;
        }
        .header-print h5 {
            font-size: 10pt;
        }
        .section-print {
            margin-bottom: 15px;
        }
        .section-print h6 {
            color: #666;
            border-bottom: 1px dashed #eee;
            padding-bottom: 5px;
            margin-bottom: 10px;
            font-size: 10pt;
        }
        .details-print dt {
            font-weight: bold;
            font-size: 9.5pt;
        }
        .details-print dd {
            font-size: 9.5pt;
        }
        .assinatura-print {
            margin-top: 40px;
            text-align: center;
        }
        .assinatura-print .line {
            border-top: 1px solid #000;
            width: 70%;
            margin: 0 auto;
            padding-top: 5px;
        }
        .assinatura-print p {
            font-size: 9pt;
            margin: 2px 0;
        }
    }

    /* Estilos para tela */
    .btn-print {
        margin-top: 20px;
    }
    .resultado-reagente { color: #dc3545; font-weight: bold; } /* Vermelho */
    .resultado-nao-reagente { color: #28a745; font-weight: bold; } /* Verde */
    .resultado-indeterminado { color: #ffc107; font-weight: bold; } /* Amarelo */
</style>

<div class="container mt-4 mb-5 no-print"> {# Container principal visível apenas na tela #}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">Imprimir Laudo do Exame de Calazar</h1>
        <a href="{{ url_for('admin_detalhe_teste_calazar', solicitacao_id=solicitacao.id) }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Voltar para Detalhes
        </a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="d-grid gap-2 mb-4">
        <button class="btn btn-primary btn-lg btn-print" onclick="window.print();">
            <i class="fas fa-print me-2"></i>Imprimir Laudo
        </button>
    </div>
</div>

{# Área que será impressa #}
<div class="printable-area">
    <div class="header-print">
        <h3>PREFEITURA MUNICIPAL DE ESPERANTINA - PI</h3>
        <h4>SECRETARIA MUNICIPAL DE SAÚDE</h4>
        <h5>Vigilância em Saúde</h5>
        <h6>LAUDO DE EXAME DE LEISHMANIOSE VISCERAL CANINA (CALAZAR)</h6>
        <p><strong>PROTOCOLO: {{ solicitacao.protocolo }}</strong></p>
        <p><strong>DATA DA SOLICITAÇÃO: {{ solicitacao.data_solicitacao.strftime('%d/%m/%Y %H:%M') }}</strong></p>
        <p><strong>DATA DO RESULTADO: {% if solicitacao.data_atendimento %}{{ solicitacao.data_atendimento.strftime('%d/%m/%Y %H:%M') }}{% else %}Não Concluído{% endif %}</strong></p>
    </div>

    <div class="section-print">
        <h6>1. Dados do Proprietário</h6>
        <dl class="row details-print">
            <dt class="col-sm-4">Nome Completo:</dt>
            <dd class="col-sm-8">{{ solicitacao.proprietario_nome }}</dd>
            <dt class="col-sm-4">CPF:</dt>
            <dd class="col-sm-8">{{ solicitacao.proprietario_cpf | default('Não informado') }}</dd>
            <dt class="col-sm-4">Endereço:</dt>
            <dd class="col-sm-8">{{ solicitacao.proprietario_endereco }}</dd>
            <dt class="col-sm-4">Telefone:</dt>
            <dd class="col-sm-8">{{ solicitacao.proprietario_telefone }}</dd>
        </dl>
    </div>

    <div class="section-print">
        <h6>2. Dados do Animal</h6>
        <dl class="row details-print">
            <dt class="col-sm-4">Nome do Animal:</dt>
            <dd class="col-sm-8">{{ solicitacao.animal_nome }}</dd>
            <dt class="col-sm-4">Espécie / Raça:</dt>
            <dd class="col-sm-8">{{ solicitacao.animal_especie }} / {{ solicitacao.animal_raca }}</dd>
            <dt class="col-sm-4">Sexo / Idade / Cor:</dt>
            <dd class="col-sm-8">{{ solicitacao.animal_sexo | default('N/A') }} / {{ solicitacao.animal_idade | default('N/A') }} / {{ solicitacao.animal_cor | default('N/A') }}</dd>
            {% if solicitacao.animal_foto_path %}
                <dt class="col-sm-4">Foto:</dt>
                <dd class="col-sm-8">Anexo</dd>
            {% endif %}
        </dl>
    </div>

    <div class="section-print">
        <h6>3. Informações Clínicas e Coleta</h6>
        <dl class="row details-print">
            <dt class="col-sm-4">Sinais Clínicos Apresentados:</dt>
            <dd class="col-sm-8">{{ solicitacao.sinais_clinicos | default('Não informado') }}</dd>
            <dt class="col-sm-4">Data/Horário Sugerido para Coleta:</dt>
            <dd class="col-sm-8">{{ solicitacao.data_coleta_sugerida.strftime('%d/%m/%Y') }} {% if solicitacao.horario_coleta_sugerido %}{{ solicitacao.horario_coleta_sugerido.strftime('%H:%M') }}{% endif %}</dd>
        </dl>
    </div>

    {# NOVO: SEÇÃO DE RESULTADO DO TESTE #}
    <div class="section-print">
        <h6>4. Resultado do Teste de Leishmaniose Visceral Canina</h6>
        <dl class="row details-print">
            <dt class="col-sm-4">Data da Realização do Teste:</dt>
            <dd class="col-sm-8">{% if solicitacao.data_realizacao_teste %}{{ solicitacao.data_realizacao_teste.strftime('%d/%m/%Y') }}{% else %}Não informada{% endif %}</dd>
            <dt class="col-sm-4">Tipo de Teste Realizado:</dt>
            <dd class="col-sm-8">{{ solicitacao.tipo_teste_realizado | default('Não informado') }}</dd>
            <dt class="col-sm-4">Kit Utilizado:</dt>
            <dd class="col-sm-8">{{ solicitacao.kit_utilizado | default('Não informado') }}</dd>
            <dt class="col-sm-4">Lote do Kit:</dt>
            <dd class="col-sm-8">{{ solicitacao.lote_kit | default('Não informado') }}</dd>
            <dt class="col-sm-4">Validade do Kit:</dt>
            <dd class="col-sm-8">{% if solicitacao.validade_kit %}{{ solicitacao.validade_kit.strftime('%d/%m/%Y') }}{% else %}Não informado{% endif %}</dd>
            <dt class="col-sm-4">Resultado do Teste Rápido:</dt>
            <dd class="col-sm-8">
                <span class="
                    {% if solicitacao.resultado_teste_rapido == 'Reagente' %}resultado-reagente
                    {% elif solicitacao.resultado_teste_rapido == 'Não Reagente' %}resultado-nao-reagente
                    {% elif solicitacao.resultado_teste_rapido == 'Indeterminado' %}resultado-indeterminado
                    {% endif %}">
                    {{ solicitacao.resultado_teste_rapido | default('Não realizado') }}
                </span>
            </dd>
            <dt class="col-sm-4">Amostra Enviada ao LACEN:</dt>
            <dd class="col-sm-8">{% if solicitacao.enviado_lacen %}Sim{% else %}Não{% endif %}</dd>
            <dt class="col-sm-4">Observações sobre o Resultado:</dt>
            <dd class="col-sm-8">{{ solicitacao.observacoes_resultado | default('Nenhuma observação.') }}</dd>
            <dt class="col-sm-4">Anamnese do Veterinário:</dt>
            <dd class="col-sm-8">{{ solicitacao.anamnese_veterinario | default('Não informado') }}</dd>
        </dl>
    </div>

    <div class="assinatura-print">
        <div class="line"></div>
        <p>Assinatura do Médico Veterinário Responsável</p>
        <p><strong>{{ solicitacao.veterinario_responsavel_nome | default('Nome do Veterinário') }}</strong></p>
        <p>CRMV: {{ solicitacao.veterinario_crmv | default('[Número do CRMV]') }}</p>
        <p>Esperantina - PI, {% if solicitacao.data_atendimento %}{{ solicitacao.data_atendimento.strftime('%d de %B de %Y') }}{% else %}Não Concluído{% endif %}</p>
    </div>
</div>
{% endblock %}