{% extends 'admin_base.html' %}
{% block title %}Ficha Cadastral - {{ autonomo.nome_completo }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">Ficha Cadastral do Autônomo</h1>
        <div>
            <a href="{{ url_for('admin_imprimir_ficha_autonomo', autonomo_id=autonomo.id) }}" class="btn btn-outline-primary no-print" target="_blank"><i class="fas fa-print me-2"></i>Imprimir Ficha</a>
            <a href="{{ url_for('admin_listar_autonomos') }}" class="btn btn-secondary">Voltar</a>
        </div>
    </div>

    <!-- Card de Dados Principais (Atualizado e Completo) -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Dados Principais</h6>
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">Nome Completo:</dt>
                <dd class="col-sm-9">{{ autonomo.nome_completo or 'Não informado' }}</dd>

                <dt class="col-sm-3">CPF:</dt>
                <dd class="col-sm-9">{{ autonomo.cpf or 'Não informado' }}</dd>

                <dt class="col-sm-3">RG:</dt>
                <dd class="col-sm-9">{{ autonomo.rg or 'Não informado' }}</dd>

                <dt class="col-sm-3">Data de Nascimento:</dt>
                <dd class="col-sm-9">{{ autonomo.data_nascimento.strftime('%d/%m/%Y') if autonomo.data_nascimento else 'Não informado' }}</dd>

                <dt class="col-sm-3">Sexo:</dt>
                <dd class="col-sm-9">{{ autonomo.sexo or 'Não informado' }}</dd>

                <dt class="col-sm-3">Telefone Celular:</dt>
                <dd class="col-sm-9">{{ autonomo.telefone_celular or 'Não informado' }}</dd>

                <dt class="col-sm-3">E-mail:</dt>
                <dd class="col-sm-9">{{ autonomo.email or 'Não informado' }}</dd>

                <dt class="col-sm-3 border-top pt-3 mt-3">Endereço Completo:</dt>
                <dd class="col-sm-9 border-top pt-3 mt-3">{{ autonomo.endereco_atendimento or 'Não informado' }}</dd>

                <dt class="col-sm-3">Tipo de Local:</dt>
                <dd class="col-sm-9">{{ autonomo.tipo_local or 'Não informado' }}</dd>

                <dt class="col-sm-3 border-top pt-3 mt-3">Profissão:</dt>
                <dd class="col-sm-9 border-top pt-3 mt-3">{{ autonomo.profissao or 'Não informado' }}</dd>

                <dt class="col-sm-3">Conselho de Classe:</dt>
                <dd class="col-sm-9">{{ autonomo.conselho_classe or 'Não informado' }}</dd>

                <dt class="col-sm-3">Nº Registro Profissional:</dt>
                <dd class="col-sm-9">{{ autonomo.numero_registro_profissional or 'Não informado' }}</dd>

                <dt class="col-sm-3">Inscrição Municipal:</dt>
                <dd class="col-sm-9">{{ autonomo.inscricao_municipal or 'Não informado' }}</dd>

                <dt class="col-sm-3">Atividades Exercidas:</dt>
                <dd class="col-sm-9">{{ autonomo.atividades_exercidas or 'Não informado' }}</dd>

                <dt class="col-sm-3">Modalidade:</dt>
                <dd class="col-sm-9">{{ autonomo.modalidade_atendimento or 'Não informado' }}</dd>
                
                <dt class="col-sm-3">Horário:</dt>
                <dd class="col-sm-9">{{ autonomo.horario_funcionamento or 'Não informado' }}</dd>
            </dl>
        </div>
    </div>

    <!-- Abas de Informações Adicionais -->
    <div class="card shadow mb-4">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="licencas-tab" data-bs-toggle="tab" data-bs-target="#licencas" type="button" role="tab" aria-controls="licencas" aria-selected="true">Licenças</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="denuncias-tab" data-bs-toggle="tab" data-bs-target="#denuncias" type="button" role="tab" aria-controls="denuncias" aria-selected="false">Denúncias</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="notificacoes-tab" data-bs-toggle="tab" data-bs-target="#notificacoes" type="button" role="tab" aria-controls="notificacoes" aria-selected="false">Notificações</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="vistorias-tab" data-bs-toggle="tab" data-bs-target="#vistorias" type="button" role="tab" aria-controls="vistorias" aria-selected="false">Vistorias</button>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="licencas" role="tabpanel" aria-labelledby="licencas-tab">
                    {% if autonomo.licencas %}
                        <div class="table-responsive">
                            <table class="table table-sm table-striped">
                                <thead>
                                    <tr>
                                        <th>Protocolo</th>
                                        <th>Ano</th>
                                        <th>Data da Solicitação</th>
                                        <th>Status</th>
                                        <th>Ação</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for licenca in autonomo.licencas|sort(attribute='data_solicitacao', reverse=true) %}
                                    <tr>
                                        <td>{{ licenca.protocolo }}</td>
                                        <td>{{ licenca.ano_exercicio }}</td>
                                        <td>{{ licenca.data_solicitacao.strftime('%d/%m/%Y') }}</td>
                                        <td>
                                            <span class="badge 
                                                {% if licenca.status == 'Aprovada' %} bg-success
                                                {% elif licenca.status == 'Reprovada' %} bg-danger
                                                {% elif licenca.status == 'Pendente com Observação' %} bg-warning text-dark
                                                {% else %} bg-secondary
                                                {% endif %}">
                                                {{ licenca.status }}
                                            </span>
                                        </td>
                                        <td>
                                            <a href="{{ url_for('admin_detalhe_licenca_autonomo', licenca_id=licenca.id) }}" class="btn btn-sm btn-outline-primary">Ver Detalhes</a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted text-center">Nenhum histórico de licenças para este autônomo.</p>
                    {% endif %}
                </div>
                <div class="tab-pane fade" id="denuncias" role="tabpanel" aria-labelledby="denuncias-tab">
                    <p>Histórico de denúncias aparecerá aqui.</p>
                </div>
                <div class="tab-pane fade" id="notificacoes" role="tabpanel" aria-labelledby="notificacoes-tab">
                    <p>Histórico de notificações aparecerá aqui.</p>
                </div>
                <div class="tab-pane fade" id="vistorias" role="tabpanel" aria-labelledby="vistorias-tab">
                    <p>Histórico de vistorias aparecerá aqui.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
