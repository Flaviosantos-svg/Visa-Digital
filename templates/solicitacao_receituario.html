{% extends 'layout.html' %}

{% block title %}Solicitação de Receituários - VISA Digital{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Solicitação de Receituários Controlados</h2>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Voltar para a Página Inicial
        </a>
    </div>

    <form method="POST" action="{{ url_for('solicitar_receituario') }}"> {# Ajustado action para a rota correta #}
        <input type="hidden" name="tipo_solicitacao" value="Solicitação de Receituários">
        
        <fieldset class="border p-3 mb-4 rounded">
            <legend class="w-auto px-2 h6">1. Dados do Local Solicitante</legend>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="cnpj_local" class="form-label">CNPJ</label>
                    <input type="text" class="form-control" id="cnpj_local" name="cnpj_local" placeholder="Digite o CNPJ" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="nome_local" class="form-label">Nome do Estabelecimento</label>
                    <input type="text" class="form-control" id="nome_local" name="nome_local" required>
                </div>
            </div>
            <div class="mb-3">
                <label for="endereco_local" class="form-label">Endereço</label>
                <input type="text" class="form-control" id="endereco_local" name="endereco_local" placeholder="Rua, Bairro, Cidade/Estado" required>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="numero_local" class="form-label">Número</label>
                    <input type="text" class="form-control" id="numero_local" name="numero_local" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="contato_local" class="form-label">Telefone do Local</label>
                    <input type="text" class="form-control" id="contato_local" name="contato_local" placeholder="(DD) 99999-9999" required>
                </div>
            </div>
        </fieldset>

        <fieldset class="border p-3 mb-4 rounded">
            <legend class="w-auto px-2 h6">2. Dados do Profissional Solicitante</legend>
            <div class="mb-3">
                <label for="nome_profissional" class="form-label">Nome Completo</label>
                <input type="text" class="form-control" id="nome_profissional" name="nome_profissional" required>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="cpf_profissional" class="form-label">CPF</label>
                    <input type="text" class="form-control" id="cpf_profissional" name="cpf_profissional" placeholder="Ex: 123.456.789-00" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="conselho_profissional" class="form-label">Nº do Conselho (Ex: CRM, CRO, CRMV)</label>
                    <input type="text" class="form-control" id="conselho_profissional" name="conselho_profissional" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="telefone_contato" class="form-label">Telefone para Contato</label>
                    <input type="text" class="form-control" id="telefone_contato" name="telefone_contato" placeholder="(DD) 99999-9999" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="email_contato" class="form-label">E-mail</label>
                    <input type="email" class="form-control" id="email_contato" name="email_contato" required>
                </div>
            </div>
        </fieldset>

        <fieldset class="border p-3 mb-4 rounded">
            <legend class="w-auto px-2 h6">3. Detalhes da Solicitação</legend>
            <div class="mb-3">
                <label class="form-label d-block">Selecione os tipos de receituário e informe a quantidade de blocos:</label>
                <div class="receituario-group p-3 border rounded bg-light"> {# Estilo de grupo para receituários #}
                    <div class="form-check d-flex align-items-center mb-3 receituario-item">
                        <input class="form-check-input me-3" type="checkbox" id="tipo_a" name="receituario_A_amarela" value="sim"> {# Nome único para cada tipo #}
                        <label class="form-check-label flex-grow-1" for="tipo_a">Notificação de Receita "A" (Amarela)</label>
                        <input type="number" class="form-control w-auto" id="quantidade_a" name="quantidade_a" min="1" placeholder="Qtde." disabled>
                    </div>
                    <div class="form-check d-flex align-items-center mb-3 receituario-item">
                        <input class="form-check-input me-3" type="checkbox" id="tipo_b1" name="receituario_B1_azul" value="sim"> {# Nome único para cada tipo #}
                        <label class="form-check-label flex-grow-1" for="tipo_b1">Notificação de Receita "B" (Azul)</label>
                        <input type="number" class="form-control w-auto" id="quantidade_b1" name="quantidade_b1" min="1" placeholder="Qtde." disabled>
                    </div>
                    <div class="form-check d-flex align-items-center mb-3 receituario-item">
                        <input class="form-check-input me-3" type="checkbox" id="tipo_b2" name="receituario_B2_sibutramina" value="sim"> {# Nome único para cada tipo #}
                        <label class="form-check-label flex-grow-1" for="tipo_b2">Notificação de Receita "B2 Sibutramina" (Azul)</label>
                        <input type="number" class="form-control w-auto" id="quantidade_b2" name="quantidade_b2" min="1" placeholder="Qtde." disabled> {# min="1" para B2 #}
                    </div>
                    <div class="form-check d-flex align-items-center receituario-item"> {# removido mb-3 do último item #}
                        <input class="form-check-input me-3" type="checkbox" id="tipo_c" name="receituario_C_branca" value="sim"> {# Nome único para cada tipo #}
                        <label class="form-check-label flex-grow-1" for="tipo_c">Receituário de Controle Especial (Branco)</label>
                        <input type="number" class="form-control w-auto" id="quantidade_c" name="quantidade_c" min="1" placeholder="Qtde." disabled>
                    </div>
                </div>
            </div>
        </fieldset>

        <button type="submit" class="btn btn-primary btn-lg">Enviar Solicitação</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Seleciona todos os checkboxes dentro de .receituario-group
        document.querySelectorAll('.receituario-group input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                // Encontra o input de quantidade associado, buscando por id
                const quantityInputId = this.id.replace('tipo_', 'quantidade_');
                const quantityInput = document.getElementById(quantityInputId);
                
                if (quantityInput) {
                    quantityInput.disabled = !this.checked; // Habilita/desabilita
                    quantityInput.required = this.checked;   // Torna obrigatório se marcado
                    if (!this.checked) {
                        quantityInput.value = ''; // Limpa o valor se desmarcar
                    }
                }
            });
        });
    });
</script>
{% endblock %}