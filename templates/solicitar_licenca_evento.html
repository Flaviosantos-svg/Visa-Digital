{% extends 'layout.html' %}
{% block title %}Solicitação de Licença Sanitária para Evento{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="card shadow">
        <div class="card-header text-center bg-primary text-white">
            <h4>Solicitação de Licença Sanitária para Evento Temporário</h4>
        </div>
        <div class="card-body p-4">
            <form method="POST" enctype="multipart/form-data" action="{{ url_for('solicitar_licenca_evento') }}">
                <!-- 1. DADOS DO SOLICITANTE -->
                <h5 class="mb-3 border-bottom pb-2">1. Dados do Solicitante</h5>
                <div class="row g-3 mb-3">
                    <div class="col-md-12"><label class="form-label">Nome completo / Razão social</label><input type="text" name="solicitante_nome" class="form-control" required></div>
                    <div class="col-md-6"><label class="form-label">CPF / CNPJ</label><input type="text" name="solicitante_cpf_cnpj" class="form-control" required></div>
                    <div class="col-md-6"><label class="form-label">RG (se Pessoa Física)</label><input type="text" name="solicitante_rg" class="form-control"></div>
                    <div class="col-md-6"><label class="form-label">Telefone</label><input type="text" name="solicitante_telefone" class="form-control" required></div>
                    <div class="col-md-6"><label class="form-label">E-mail</label><input type="email" name="solicitante_email" class="form-control" required></div>
                    <div class="col-md-12"><label class="form-label">Endereço do solicitante</label><input type="text" name="solicitante_endereco" class="form-control"></div>
                </div>
                <hr class="my-4">

                <!-- 2. DADOS DO EVENTO -->
                <h5 class="mb-3 border-bottom pb-2">2. Dados do Evento</h5>
                <div class="row g-3 mb-3">
                    <div class="col-md-12"><label class="form-label">Nome do evento</label><input type="text" name="evento_nome" class="form-control" required></div>
                    <div class="col-md-12"><label class="form-label">Tipo de evento</label>
                        <div class="d-flex flex-wrap">
                            {% set tipos = ['Festa', 'Feira', 'Evento religioso', 'Show'] %}
                            {% for tipo in tipos %}<div class="form-check me-3"><input class="form-check-input" type="checkbox" name="evento_tipo" value="{{ tipo }}" id="tipo_{{ loop.index }}"><label class="form-check-label" for="tipo_{{ loop.index }}">{{ tipo }}</label></div>{% endfor %}
                            <div class="form-check d-flex align-items-center"><input class="form-check-input" type="checkbox" name="evento_tipo" value="Outro" id="tipo_outro"><label class="form-check-label me-2" for="tipo_outro">Outro:</label><input type="text" class="form-control form-control-sm" name="evento_tipo_outro"></div>
                        </div>
                    </div>
                    <div class="col-md-12"><label class="form-label">Local do evento (Endereço completo)</label><input type="text" name="evento_local" class="form-control" required></div>
                    <div class="col-md-4"><label class="form-label">Data de Início</label><input type="date" class="form-control" name="evento_data_inicio" required></div>
                    <div class="col-md-4"><label class="form-label">Data de Fim</label><input type="date" class="form-control" name="evento_data_fim" required></div>
                    <div class="col-md-4"><label class="form-label">Horário (Das / Às)</label><input type="text" class="form-control" name="evento_horario"></div>
                </div>
                <hr class="my-4">

                <!-- 3. ESTRUTURA DO EVENTO -->
                <h5 class="mb-3 border-bottom pb-2">3. Estrutura do Evento</h5>
                <div class="mb-3"><label class="form-label d-block">Vai vender bebidas?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="vende_bebidas" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="vende_bebidas" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <div class="p-3 mb-3 border rounded bg-light-subtle"><label class="form-label d-block">Em que tipo de casco?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="tipo_casco" value="vidro"><label class="form-check-label">Vidro</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="tipo_casco" value="lata"><label class="form-check-label">Lata</label></div></div>

                <div class="mb-3"><label class="form-label d-block">Vai utilizar alguma estrutura montável (Barraca, Tenda, Stand)?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_estrutura_montavel" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_estrutura_montavel" value="nao" checked><label class="form-check-label">Não</label></div></div>
                
                <div class="mb-3"><label class="form-label d-block">Vai utilizar churrasqueira?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_churrasqueira" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_churrasqueira" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <div class="p-3 mb-3 border rounded bg-light-subtle"><label class="form-label d-block">Tipo de churrasqueira:</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="churrasqueira_tipo" value="gas"><label class="form-check-label">A Gás</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="churrasqueira_tipo" value="carvao" checked><label class="form-check-label">A Carvão</label></div><div class="mt-2"><label class="form-label d-block">Se for a gás, o registro e a mangueira estão dentro da validade?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="churrasqueira_gas_validade" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="churrasqueira_gas_validade" value="nao" checked><label class="form-check-label">Não</label></div></div></div>

                <div class="mb-3"><label class="form-label d-block">Vai utilizar fritadeira a gás?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_fritadeira" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_fritadeira" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <div class="p-3 mb-3 border rounded bg-light-subtle"><label class="form-label d-block">O registro e a mangueira do gás estão dentro da validade?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="fritadeira_gas_validade" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="fritadeira_gas_validade" value="nao" checked><label class="form-check-label">Não</label></div></div>

                <div class="mb-3"><label class="form-label d-block">Vai manipular alimentos?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="manipula_alimentos" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="manipula_alimentos" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <div class="p-3 mb-3 border rounded bg-light-subtle"><label class="form-label d-block">Tem pia com água para lavagem dos utensílios?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="tem_pia" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="tem_pia" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <hr class="my-4">

                <!-- 4. BOMBEIROS -->
                <h5 class="mb-3 border-bottom pb-2">4. Liberação do Corpo de Bombeiros</h5>
                <div class="mb-3"><label class="form-label d-block">Tem liberação do Corpo de Bombeiros?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="bombeiros_liberacao" id="bombeiros_sim" value="sim"><label class="form-check-label" for="bombeiros_sim">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="bombeiros_liberacao" id="bombeiros_nao" value="nao" checked><label class="form-check-label" for="bombeiros_nao">Não</label></div></div>
                <div class="p-3 mb-3 border rounded bg-light-subtle"><div class="row g-3"><div class="col-md-6"><label for="bombeiros_numero" class="form-label">Número da Autorização</label><input type="text" name="bombeiros_numero" id="bombeiros_numero" class="form-control"></div><div class="col-md-6"><label for="bombeiros_data" class="form-label">Data de Emissão</label><input type="date" name="bombeiros_data" id="bombeiros_data" class="form-control"></div><div class="col-12"><label for="anexo_bombeiros" class="form-label">Anexar Documento de Liberação</label><input type="file" name="anexo_bombeiros" id="anexo_bombeiros" class="form-control"></div></div></div>
                <hr class="my-4">

                <!-- 5. DOCUMENTAÇÃO EXIGIDA -->
                <h5 class="mb-3 border-bottom pb-2">5. Documentação Exigida (Anexar)</h5>
                <div class="mb-3">
                    {% set docs = [('anexo_cpf_cnpj', 'Cópia do CPF/CNPJ e RG'), ('anexo_alvara_local', 'Cópia do alvará de funcionamento do local (se aplicável)'), ('anexo_autorizacao_rua', 'Autorização da prefeitura para evento em via pública (se aplicável)')] %}
                    {% for name, label in docs %}<div class="row mb-2 align-items-center"><div class="col-md-6"><label for="{{ name }}" class="form-label mb-0">{{ label }}</label></div><div class="col-md-6"><input class="form-control" type="file" name="{{ name }}" id="{{ name }}"></div></div>{% endfor %}
                </div>
                <hr class="my-4">
                
                <!-- 6. DECLARAÇÃO -->
                <h5 class="mb-3 border-bottom pb-2">6. Declaração do Solicitante</h5>
                <div class="form-check"><input class="form-check-input" type="checkbox" name="declaracao_final" id="declaracao_final" required><label class="form-check-label" for="declaracao_final">Declaro que as informações acima são verdadeiras e que o evento respeitará as normas sanitárias vigentes.</label></div>

                <button type="submit" class="btn btn-primary w-100 btn-lg mt-4">Enviar Solicitação</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- O JavaScript foi removido pois não é mais necessário -->
{% endblock %}

{% raw %}{% extends 'layout.html' %}
{% block title %}Solicitação de Licença Sanitária para Evento{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="card shadow">
        <div class="card-header text-center bg-primary text-white">
            <h4>Solicitação de Licença Sanitária para Evento Temporário</h4>
        </div>
        <div class="card-body p-4">
            <form method="POST" enctype="multipart/form-data" action="{{ url_for('solicitar_licenca_evento') }}">
                <h5 class="mb-3 border-bottom pb-2">1. Dados do Solicitante</h5>
                <div class="row g-3 mb-3">
                    <div class="col-md-12"><label class="form-label">Nome completo / Razão social</label><input type="text" name="solicitante_nome" class="form-control" required></div>
                    <div class="col-md-6"><label class="form-label">CPF / CNPJ</label><input type="text" name="solicitante_cpf_cnpj" class="form-control" required></div>
                    <div class="col-md-6"><label class="form-label">RG (se Pessoa Física)</label><input type="text" name="solicitante_rg" class="form-control"></div>
                    <div class="col-md-6"><label class="form-label">Telefone</label><input type="text" name="solicitante_telefone" class="form-control" required></div>
                    <div class="col-md-6"><label class="form-label">E-mail</label><input type="email" name="solicitante_email" class="form-control" required></div>
                    <div class="col-md-12"><label class="form-label">Endereço do solicitante</label><input type="text" name="solicitante_endereco" class="form-control"></div>
                </div>
                <hr class="my-4">

                <h5 class="mb-3 border-bottom pb-2">2. Dados do Evento</h5>
                <div class="row g-3 mb-3">
                    <div class="col-md-12"><label class="form-label">Nome do evento</label><input type="text" name="evento_nome" class="form-control" required></div>
                    <div class="col-md-12"><label class="form-label">Tipo de evento</label>
                        <div class="d-flex flex-wrap">
                            {% set tipos = ['Festa', 'Feira', 'Evento religioso', 'Show'] %}
                            {% for tipo in tipos %}<div class="form-check me-3"><input class="form-check-input" type="checkbox" name="evento_tipo" value="{{ tipo }}" id="tipo_{{ loop.index }}"><label class="form-check-label" for="tipo_{{ loop.index }}">{{ tipo }}</label></div>{% endfor %}
                            <div class="form-check d-flex align-items-center"><input class="form-check-input" type="checkbox" name="evento_tipo" value="Outro" id="tipo_outro"><label class="form-check-label me-2" for="tipo_outro">Outro:</label><input type="text" class="form-control form-control-sm" name="evento_tipo_outro"></div>
                        </div>
                    </div>
                    <div class="col-md-12"><label class="form-label">Local do evento (Endereço completo)</label><input type="text" name="evento_local" class="form-control" required></div>
                    <div class="col-md-4"><label class="form-label">Data de Início</label><input type="date" class="form-control" name="evento_data_inicio" required></div>
                    <div class="col-md-4"><label class="form-label">Data de Fim</label><input type="date" class="form-control" name="evento_data_fim" required></div>
                    <div class="col-md-4"><label class="form-label">Horário (Das / Às)</label><input type="text" class="form-control" name="evento_horario"></div>
                </div>
                <hr class="my-4">

                <h5 class="mb-3 border-bottom pb-2">3. Estrutura do Evento</h5>
                <div class="mb-3"><label class="form-label d-block">Vai vender bebidas?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="vende_bebidas" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="vende_bebidas" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <div id="detalhes-bebidas" class="p-3 mb-3 border rounded bg-light-subtle" style="display: none;"><label class="form-label d-block">Em que tipo de casco?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="tipo_casco" value="vidro"><label class="form-check-label">Vidro</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="tipo_casco" value="lata"><label class="form-check-label">Lata</label></div></div>

                <div class="mb-3"><label class="form-label d-block">Vai utilizar alguma estrutura montável (Barraca, Tenda, Stand)?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_estrutura_montavel" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_estrutura_montavel" value="nao" checked><label class="form-check-label">Não</label></div></div>
                
                <div class="mb-3"><label class="form-label d-block">Vai utilizar churrasqueira?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_churrasqueira" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_churrasqueira" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <div id="detalhes-churrasqueira" class="p-3 mb-3 border rounded bg-light-subtle" style="display: none;"><label class="form-label d-block">Tipo de churrasqueira:</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="churrasqueira_tipo" value="gas"><label class="form-check-label">A Gás</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="churrasqueira_tipo" value="carvao" checked><label class="form-check-label">A Carvão</label></div><div class="mt-2"><label class="form-label d-block">Se for a gás, o registro e a mangueira estão dentro da validade?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="churrasqueira_gas_validade" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="churrasqueira_gas_validade" value="nao" checked><label class="form-check-label">Não</label></div></div></div>

                <div class="mb-3"><label class="form-label d-block">Vai utilizar fritadeira a gás?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_fritadeira" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="usa_fritadeira" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <div id="detalhes-fritadeira" class="p-3 mb-3 border rounded bg-light-subtle" style="display: none;"><label class="form-label d-block">O registro e a mangueira do gás estão dentro da validade?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="fritadeira_gas_validade" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="fritadeira_gas_validade" value="nao" checked><label class="form-check-label">Não</label></div></div>

                <div class="mb-3"><label class="form-label d-block">Vai manipular alimentos?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="manipula_alimentos" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="manipula_alimentos" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <div id="detalhes-alimentos" class="p-3 mb-3 border rounded bg-light-subtle" style="display: none;"><label class="form-label d-block">Tem pia com água para lavagem dos utensílios?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="tem_pia" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="tem_pia" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <hr class="my-4">

                <h5 class="mb-3 border-bottom pb-2">4. Liberação do Corpo de Bombeiros</h5>
                <div class="mb-3"><label class="form-label d-block">Tem liberação do Corpo de Bombeiros?</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="bombeiros_liberacao" value="sim"><label class="form-check-label">Sim</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="bombeiros_liberacao" value="nao" checked><label class="form-check-label">Não</label></div></div>
                <div id="detalhes-bombeiros" class="p-3 mb-3 border rounded bg-light-subtle" style="display: none;"><div class="row g-3"><div class="col-md-6"><label for="bombeiros_numero" class="form-label">Número da Autorização</label><input type="text" name="bombeiros_numero" id="bombeiros_numero" class="form-control"></div><div class="col-md-6"><label for="bombeiros_data" class="form-label">Data de Emissão</label><input type="date" name="bombeiros_data" id="bombeiros_data" class="form-control"></div><div class="col-12"><label for="anexo_bombeiros" class="form-label">Anexar Documento de Liberação</label><input type="file" name="anexo_bombeiros" id="anexo_bombeiros" class="form-control"></div></div></div>
                <hr class="my-4">

                <h5 class="mb-3 border-bottom pb-2">5. Documentação Exigida (Anexar)</h5>
                <div class="mb-3">
                    {% set docs = [('anexo_cpf_cnpj', 'Cópia do CPF/CNPJ e RG'), ('anexo_alvara_local', 'Cópia do alvará de funcionamento do local (se aplicável)'), ('anexo_autorizacao_rua', 'Autorização da prefeitura para evento em via pública (se aplicável)')] %}
                    {% for name, label in docs %}<div class="row mb-2 align-items-center"><div class="col-md-6"><label for="{{ name }}" class="form-label mb-0">{{ label }}</label></div><div class="col-md-6"><input class="form-control" type="file" name="{{ name }}" id="{{ name }}"></div></div>{% endfor %}
                </div>
                <hr class="my-4">
                
                <h5 class="mb-3 border-bottom pb-2">6. Declaração do Solicitante</h5>
                <div class="form-check"><input class="form-check-input" type="checkbox" name="declaracao_final" id="declaracao_final" required><label class="form-check-label" for="declaracao_final">Declaro que as informações acima são verdadeiras e que o evento respeitará as normas sanitárias vigentes.</label></div>

                <button type="submit" class="btn btn-primary w-100 btn-lg mt-4">Enviar Solicitação</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    /**
     * Função reutilizável para configurar a exibição condicional de um elemento.
     * @param {string} radioName - O atributo 'name' dos botões de rádio.
     * @param {string} targetDivId - O 'id' do elemento div que será exibido ou ocultado.
     */
    function setupConditionalDisplay(radioName, targetDivId) {
        const radios = document.querySelectorAll(`input[type="radio"][name="${radioName}"]`);
        const targetDiv = document.getElementById(targetDivId);

        // Função para verificar o valor selecionado e alternar a visibilidade
        const toggleVisibility = () => {
            const selectedRadio = document.querySelector(`input[type="radio"][name="${radioName}"]:checked`);
            if (selectedRadio && selectedRadio.value === 'sim') {
                targetDiv.style.display = 'block';
            } else {
                targetDiv.style.display = 'none';
            }
        };

        // Adiciona um ouvinte de evento para cada botão de rádio
        radios.forEach(radio => {
            radio.addEventListener('change', toggleVisibility);
        });

        // Executa a função uma vez no carregamento da página para definir o estado inicial
        toggleVisibility();
    }

    // Configura a lógica para cada par de pergunta e subpergunta
    setupConditionalDisplay('vende_bebidas', 'detalhes-bebidas');
    setupConditionalDisplay('usa_churrasqueira', 'detalhes-churrasqueira');
    setupConditionalDisplay('usa_fritadeira', 'detalhes-fritadeira');
    setupConditionalDisplay('manipula_alimentos', 'detalhes-alimentos');
    setupConditionalDisplay('bombeiros_liberacao', 'detalhes-bombeiros');
});
</script>
{% endblock %}
{% endraw %}